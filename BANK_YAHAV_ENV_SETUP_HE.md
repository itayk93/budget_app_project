# הגדרת מצב היברידי לבנק יהב (ENV + DB)

## סקירה כללית
מערכת כריית הנתונים הבנקיים מאפשרת כעת מצב היברידי מאובטח לבנק יהב:
- **הסיסמה** נשמרת במשתני הסביבה (ENV) 
- **שם המשתמש ותעודת הזהות** נשמרים במסד הנתונים כרגיל

## יתרונות של המצב ההיברידי:
- **אבטחה מקסימלית**: הסיסמה הרגישה ביותר מוגנת ברמת השרת
- **גמישות**: ניתן לערוך שם משתמש ותעודת זהות דרך הממשק הרגיל  
- **קלות ניהול**: לא צריך לערוך את ה-ENV עבור שינויים קטנים
- **בקרה מוגברת**: הסיסמה נשארת תחת השליטה הישירה שלך

## הוראות הגדרה:

### שלב 1: עריכת קובץ .env - סיסמה בלבד
פתח את הקובץ `.env` בתיקיית הפרויקט ועדכן את השורה הבאה:

```env
YAHAV_BANK_PASSWORD=your_actual_yahav_password
```

**החלף את הערך:**
- `your_actual_yahav_password` - הסיסמה שלך בבנק יהב בלבד

### שלב 2: הוספת קונפיגורציה בממשק
1. פתח את דף כריית הנתונים הבנקיים
2. לחץ על "הוסף קונפיגורציה חדשה"
3. בחר "בנק יהב" מהרשימה
4. הזן **רק** שם משתמש ותעודת זהות (שדה הסיסמה יהיה מושבת)
5. שמור את הקונפיגורציה

### שלב 3: וידוא ההגדרות
וודא שהשורות הבאות קיימות בקובץ .env:

```env
BANK_ENV_CREDENTIALS_ENABLED=true
BANK_ENV_ALLOWED_BANKS=yahav
```

## איך המצב ההיברידי עובד:

1. **יצירת קונפיגורציה**: אתה מזין שם משתמש ותעודת זהות דרך הממשק
2. **שמירה במסד נתונים**: שם המשתמש ותעודת הזהות נשמרים מוצפנים במסד הנתונים  
3. **כריית נתונים**: כשמריצים כריה, המערכת משלבת:
   - שם משתמש ותעודת זהות מהמסד נתונים
   - סיסמה מ-ENV (YAHAV_BANK_PASSWORD)
4. **חיבור לבנק**: השילוב מעביר כל הפרטים הנדרשים לבנק יהב

## בטיחות:

⚠️ **חשוב מאוד:**
- אל תשתף את קובץ ה-`.env` עם אף אחד
- אל תעלה את קובץ ה-`.env` ל-Git או לאף מקום ציבורי
- שמור על פרטי הכניסה מעודכנים
- אם אתה משנה סיסמה בבנק, עדכן גם בקובץ ה-`.env`

## בעיות נפוצות:

### שגיאת "Missing or invalid YAHAV_BANK_PASSWORD"
אם אתה מקבל שגיאה זו, בדוק ש:
- הסיסמה מולאה נכון בקובץ `.env`
- אין רווחים נוספים בתחילת או בסוף הסיסמה
- השרת אותחל לאחר שינוי ה-`.env`

### שגיאת "Missing username or nationalID"
אם אתה מקבל שגיאה זו:
- וודא ששם המשתמש ותעודת הזהות נשמרו בקונפיגורציה
- נסה לערוך את הקונפיגורציה ולהזין שוב את הפרטים

### שגיאת כניסה לבנק
אם הכניסה לבנק נכשלת:
- וודא שהסיסמה ב-ENV נכונה ועדכנית
- בדוק ששם המשתמש ותעודת הזהות נכונים בקונפיגורציה
- נסה להתחבר לבנק דרך הדפדפן כדי לוודא שהחשבון לא חסום

## הרצה:
לאחר עריכת הקובץ `.env`, הפעל מחדש את השרת:

```bash
npm restart
```

או עצור והפעל שוב:

```bash
# עצור את השרת (Ctrl+C)
npm start
```

## בדיקת התקנה:
כשתנסה להריץ כריית נתונים עבור בנק יהב, המערכת תדפיס בלוג:
```
🌍 Using hybrid ENV+DB credentials for yahav
✅ Successfully loaded hybrid credentials for yahav: username + nationalID from DB, password from ENV
```

אם אתה רואה הודעות אלה, המצב ההיברידי פועל בהצלחה!

## סיכום המצב ההיברידי:
✅ **הסיסמה מוגנת ב-ENV** - אבטחה מקסימלית  
✅ **שם משתמש ות"ז במסד נתונים** - גמישות ועריכה קלה  
✅ **ממשק משתמש ידידותי** - שדה סיסמה מושבת אוטומטית ליהב  
✅ **תיעוד מלא בעברית** - הוראות ברורות לכל שלב